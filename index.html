<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stroop Test</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a2e;
            color: #eee;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            user-select: none;
        }

        #start-screen, #game-screen, #end-screen {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
        }

        #start-screen.active, #game-screen.active, #end-screen.active {
            display: flex;
        }

        h1 { font-size: 2.5rem; margin-bottom: 1rem; }

        .instructions {
            max-width: 500px;
            text-align: center;
            line-height: 1.6;
            margin-bottom: 2rem;
            color: #aaa;
            font-size: 1.1rem;
        }

        .instructions strong { color: #fff; }

        #start-btn, #restart-btn {
            padding: 1rem 3rem;
            font-size: 1.3rem;
            border: none;
            border-radius: 8px;
            background: #e94560;
            color: #fff;
            cursor: pointer;
            transition: transform 0.1s, background 0.2s;
        }

        #start-btn:hover, #restart-btn:hover {
            background: #c73651;
            transform: scale(1.05);
        }

        #color-word {
            font-size: 6rem;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 1rem;
        }

        #timer-bar-container {
            width: 400px;
            max-width: 90vw;
            height: 8px;
            background: #333;
            border-radius: 4px;
            margin-bottom: 3rem;
            overflow: hidden;
        }

        #timer-bar {
            height: 100%;
            width: 100%;
            background: #0f3460;
            border-radius: 4px;
            transition: width linear, background linear;
        }

        #timer-bar.warning { background: #e94560; }

        .buttons {
            display: flex;
            gap: 1.2rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .color-btn {
            width: 120px;
            height: 60px;
            border: 3px solid #444;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            text-transform: uppercase;
            transition: transform 0.1s, border-color 0.2s;
            color: #fff;
        }

        .color-btn:hover {
            transform: scale(1.08);
            border-color: #fff;
        }

        .color-btn[data-color="red"]   { background: #dc3545; }
        .color-btn[data-color="green"] { background: #28a745; }
        .color-btn[data-color="blue"]  { background: #007bff; }
        .color-btn[data-color="grey"]   { background: #808080; }
        .color-btn[data-color="yellow"] { background: #d4a017; color: #fff; }

        #end-screen h1 { font-size: 2rem; }

        #final-score {
            font-size: 5rem;
            font-weight: 900;
            color: #e94560;
            margin: 1rem 0;
        }

        #end-message {
            color: #aaa;
            font-size: 1.2rem;
            margin-bottom: 2rem;
        }

        .prompt-label {
            font-size: 1rem;
            color: #666;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.15em;
        }

        .toggle-row {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 2rem;
            color: #aaa;
            font-size: 1rem;
        }

        .toggle {
            position: relative;
            width: 48px;
            height: 26px;
            cursor: pointer;
        }

        .toggle input { opacity: 0; width: 0; height: 0; }

        .toggle-track {
            position: absolute;
            inset: 0;
            background: #444;
            border-radius: 13px;
            transition: background 0.2s;
        }

        .toggle input:checked + .toggle-track { background: #e94560; }

        .toggle-track::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 20px;
            height: 20px;
            background: #fff;
            border-radius: 50%;
            transition: transform 0.2s;
        }

        .toggle input:checked + .toggle-track::after {
            transform: translateX(22px);
        }

        .toggle input:disabled + .toggle-track {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .toggle-row.disabled {
            opacity: 0.6;
        }

        .color-btn.no-label { color: transparent; }
        .color-btn.no-fill { background: #333 !important; }

        #pause-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(26, 26, 46, 0.95);
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }

        #pause-overlay.active { display: flex; }

        #pause-overlay h2 {
            font-size: 2rem;
            margin-bottom: 1rem;
            color: #e94560;
        }

        #pause-overlay p {
            font-size: 1.2rem;
            color: #aaa;
            text-align: center;
            line-height: 1.6;
            max-width: 400px;
        }

        #pause-overlay .countdown {
            font-size: 3rem;
            font-weight: 900;
            color: #fff;
            margin-top: 1.5rem;
        }

        .difficulty-selector {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .difficulty-btn {
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            font-weight: 600;
            border: 2px solid #444;
            border-radius: 8px;
            background: transparent;
            color: #aaa;
            cursor: pointer;
            transition: all 0.2s;
        }

        .difficulty-btn:hover {
            border-color: #666;
            color: #fff;
        }

        .difficulty-btn.selected {
            border-color: #e94560;
            background: #e94560;
            color: #fff;
        }

        .difficulty-info {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 1.5rem;
            text-align: center;
            min-height: 1.2em;
        }

        .custom-toggles {
            display: none;
            flex-direction: column;
            align-items: flex-start;
        }

        .custom-toggles.visible {
            display: flex;
        }

        .custom-toggles .toggle-row {
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>

<div id="start-screen" class="active">
    <h1>Stroop Test</h1>
    <p class="instructions">
        A colour word will appear on screen, but displayed in a <strong>different colour</strong>.<br><br>
        Your task: identify the <strong>colour of the text</strong>, not the word itself.
    </p>
    <div class="difficulty-selector">
        <button class="difficulty-btn selected" data-difficulty="easy">Easy</button>
        <button class="difficulty-btn" data-difficulty="medium">Medium</button>
        <button class="difficulty-btn" data-difficulty="hard">Hard</button>
        <button class="difficulty-btn" data-difficulty="custom">Custom</button>
    </div>
    <div class="difficulty-info" id="difficulty-info">Labels shown, 10s timer, min 2s</div>
    <div class="custom-toggles" id="custom-toggles">
        <div class="toggle-row">
            <label class="toggle">
                <input type="checkbox" id="show-labels" checked>
                <span class="toggle-track"></span>
            </label>
            <span>Show labels on buttons</span>
        </div>
        <div class="toggle-row">
            <label class="toggle">
                <input type="checkbox" id="shuffle-buttons">
                <span class="toggle-track"></span>
            </label>
            <span>Shuffle buttons every 10 answers</span>
        </div>
        <div class="toggle-row">
            <label class="toggle">
                <input type="checkbox" id="shuffle-every-answer">
                <span class="toggle-track"></span>
            </label>
            <span>Shuffle every answer</span>
        </div>
        <div class="toggle-row">
            <label class="toggle">
                <input type="checkbox" id="no-colour-fill">
                <span class="toggle-track"></span>
            </label>
            <span>Remove colour fill from buttons</span>
        </div>
    </div>
    <button id="start-btn">Start</button>
</div>

<div id="game-screen">
    <div class="prompt-label">What colour is the text?</div>
    <div id="color-word">RED</div>
    <div id="timer-bar-container">
        <div id="timer-bar"></div>
    </div>
    <div class="buttons">
        <button class="color-btn" data-color="red">Red</button>
        <button class="color-btn" data-color="green">Green</button>
        <button class="color-btn" data-color="blue">Blue</button>
        <button class="color-btn" data-color="grey">Grey</button>
        <button class="color-btn" data-color="yellow">Yellow</button>
    </div>
</div>

<div id="pause-overlay">
    <h2>Level Up!</h2>
    <p id="pause-message"></p>
    <div class="countdown" id="pause-countdown">5</div>
</div>

<div id="end-screen">
    <h1>Game Over</h1>
    <div id="end-message"></div>
    <div id="final-score">0</div>
    <div class="prompt-label">streak</div>
    <div id="avg-response" style="font-size:2.5rem;font-weight:900;color:#0f3460;margin-top:1.5rem">0.0 s</div>
    <div class="prompt-label" style="margin-bottom:2rem">avg response time</div>
    <button id="restart-btn">Play Again</button>
</div>

<script>
    const COLORS = ['red', 'green', 'blue', 'grey', 'yellow'];
    const COLOR_CSS = { red: '#dc3545', green: '#28a745', blue: '#007bff', grey: '#999', yellow: '#e6c619' };

    const DIFFICULTY_PRESETS = {
        easy: {
            showLabels: true,
            shuffleEnabled: false,
            shuffleEveryAnswer: false,
            noColourFill: false,
            initialTime: 10000,
            minTime: 2000,
            info: 'Labels shown, 10s timer, min 2s'
        },
        medium: {
            showLabels: false,
            shuffleEnabled: true,
            shuffleEveryAnswer: false,
            noColourFill: false,
            initialTime: 8000,
            minTime: 2000,
            info: 'No labels, shuffle every 10, 8s timer'
        },
        hard: {
            showLabels: true,
            shuffleEnabled: false,
            shuffleEveryAnswer: true,
            noColourFill: true,
            initialTime: 6000,
            minTime: 1000,
            info: 'No colour fill, shuffle every answer, 6s timer, min 1s'
        }
    };

    let wordIndex = 0;
    let streak = 0;
    let currentFillColor = '';
    let timerStart = 0;
    let timerRAF = 0;
    let timeout = 0;
    let showLabels = true;
    let timeLimit = 10000;
    let minTimeLimit = 2000;
    let pauseCountdownInterval = 0;
    let shuffleEnabled = false;
    let shuffleEveryAnswer = false;
    let noColourFill = false;
    let responseTimes = [];
    let selectedDifficulty = 'easy';

    const startScreen = document.getElementById('start-screen');
    const gameScreen = document.getElementById('game-screen');
    const endScreen = document.getElementById('end-screen');
    const colorWord = document.getElementById('color-word');
    const timerBar = document.getElementById('timer-bar');
    const finalScore = document.getElementById('final-score');
    const endMessage = document.getElementById('end-message');
    const buttons = document.querySelectorAll('.color-btn');
    const buttonsContainer = document.querySelector('.buttons');
    const pauseOverlay = document.getElementById('pause-overlay');
    const pauseMessage = document.getElementById('pause-message');
    const pauseCountdown = document.getElementById('pause-countdown');
    const difficultyBtns = document.querySelectorAll('.difficulty-btn');
    const difficultyInfo = document.getElementById('difficulty-info');
    const customToggles = document.getElementById('custom-toggles');

    document.getElementById('start-btn').addEventListener('click', startGame);
    document.getElementById('restart-btn').addEventListener('click', () => show(startScreen));
    buttons.forEach(btn => btn.addEventListener('click', () => handleAnswer(btn.dataset.color)));

    // Force labels on when no-colour-fill is enabled (otherwise game is impossible)
    const noColourFillCheckbox = document.getElementById('no-colour-fill');
    const showLabelsCheckbox = document.getElementById('show-labels');
    const showLabelsRow = showLabelsCheckbox.closest('.toggle-row');

    noColourFillCheckbox.addEventListener('change', () => {
        if (noColourFillCheckbox.checked) {
            showLabelsCheckbox.checked = true;
            showLabelsCheckbox.disabled = true;
            showLabelsRow.classList.add('disabled');
        } else {
            showLabelsCheckbox.disabled = false;
            showLabelsRow.classList.remove('disabled');
        }
    });

    difficultyBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            difficultyBtns.forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            selectedDifficulty = btn.dataset.difficulty;

            if (selectedDifficulty === 'custom') {
                customToggles.classList.add('visible');
                difficultyInfo.textContent = 'Configure your own settings';
            } else {
                customToggles.classList.remove('visible');
                difficultyInfo.textContent = DIFFICULTY_PRESETS[selectedDifficulty].info;
            }
        });
    });

    function show(screen) {
        [startScreen, gameScreen, endScreen].forEach(s => s.classList.remove('active'));
        screen.classList.add('active');
    }

    function startGame() {
        wordIndex = 0;
        streak = 0;
        responseTimes = [];

        if (selectedDifficulty === 'custom') {
            showLabels = document.getElementById('show-labels').checked;
            shuffleEnabled = document.getElementById('shuffle-buttons').checked;
            shuffleEveryAnswer = document.getElementById('shuffle-every-answer').checked;
            noColourFill = document.getElementById('no-colour-fill').checked;
            timeLimit = 10000;
            minTimeLimit = 2000;
        } else {
            const preset = DIFFICULTY_PRESETS[selectedDifficulty];
            showLabels = preset.showLabels;
            shuffleEnabled = preset.shuffleEnabled;
            shuffleEveryAnswer = preset.shuffleEveryAnswer;
            noColourFill = preset.noColourFill;
            timeLimit = preset.initialTime;
            minTimeLimit = preset.minTime;
        }

        buttons.forEach(btn => btn.classList.toggle('no-label', !showLabels));
        buttons.forEach(btn => btn.classList.toggle('no-fill', noColourFill));
        show(gameScreen);
        nextRound();
    }

    function pickRandomColor(exclude) {
        const options = COLORS.filter(c => c !== exclude);
        return options[Math.floor(Math.random() * options.length)];
    }

    function nextRound() {
        const word = COLORS[wordIndex % COLORS.length];
        currentFillColor = pickRandomColor(word);
        wordIndex++;

        colorWord.textContent = word.toUpperCase();
        colorWord.style.color = COLOR_CSS[currentFillColor];

        timerBar.style.transition = 'none';
        timerBar.style.width = '100%';
        timerBar.classList.remove('warning');
        // force reflow
        void timerBar.offsetWidth;
        timerBar.style.transition = `width ${timeLimit}ms linear, background 0.3s linear`;
        timerBar.style.width = '0%';

        timerStart = performance.now();
        cancelAnimationFrame(timerRAF);
        clearTimeout(timeout);

        timerRAF = requestAnimationFrame(function tick() {
            const elapsed = performance.now() - timerStart;
            if (elapsed > timeLimit * 0.6) timerBar.classList.add('warning');
            if (elapsed < timeLimit) timerRAF = requestAnimationFrame(tick);
        });

        timeout = setTimeout(() => endGame('Time ran out!'), timeLimit);
    }

    function handleAnswer(chosen) {
        if (!gameScreen.classList.contains('active')) return;
        if (pauseOverlay.classList.contains('active')) return;

        clearTimeout(timeout);
        cancelAnimationFrame(timerRAF);

        if (chosen === currentFillColor) {
            responseTimes.push(performance.now() - timerStart);
            streak++;
            if (shuffleEveryAnswer) shuffleButtonOrder();
            const canReduceTime = timeLimit > minTimeLimit;
            if (streak > 0 && streak % 10 === 0 && (canReduceTime || shuffleEnabled)) {
                showPause();
            } else {
                nextRound();
            }
        } else {
            endGame(`The answer was ${currentFillColor.toUpperCase()}.`);
        }
    }

    function showPause() {
        const canReduceTime = timeLimit > minTimeLimit;
        const newLimit = canReduceTime ? Math.max(timeLimit - 1000, minTimeLimit) : timeLimit;
        const newSeconds = newLimit / 1000;

        let msg = `Nice work! ${streak} in a row!`;
        if (canReduceTime) {
            msg += ` Time per round is now ${newSeconds} second${newSeconds !== 1 ? 's' : ''}.`;
        }
        if (shuffleEnabled) {
            msg += ' Buttons shuffled!';
        }
        pauseMessage.textContent = msg;
        pauseCountdown.textContent = '5';
        pauseOverlay.classList.add('active');

        let remaining = 5;
        clearInterval(pauseCountdownInterval);
        pauseCountdownInterval = setInterval(() => {
            remaining--;
            pauseCountdown.textContent = remaining;
            if (remaining <= 0) {
                clearInterval(pauseCountdownInterval);
                pauseOverlay.classList.remove('active');
                timeLimit = newLimit;
                if (shuffleEnabled) shuffleButtonOrder();
                nextRound();
            }
        }, 1000);
    }

    function shuffleButtonOrder() {
        const btns = Array.from(buttonsContainer.children);
        for (let i = btns.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [btns[i], btns[j]] = [btns[j], btns[i]];
        }
        btns.forEach(btn => buttonsContainer.appendChild(btn));
    }

    function endGame(reason) {
        clearTimeout(timeout);
        cancelAnimationFrame(timerRAF);
        endMessage.textContent = reason;
        finalScore.textContent = streak;
        const avg = responseTimes.length > 0
            ? (responseTimes.reduce((a, b) => a + b, 0) / responseTimes.length / 1000).toFixed(1)
            : '0.0';
        document.getElementById('avg-response').textContent = avg + ' s';
        show(endScreen);
    }
</script>

</body>
</html>
